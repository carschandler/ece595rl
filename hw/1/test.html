<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Robert (Cars) Chandler – chandl71@purdue.edu">

<title>ECE59500RL HW1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="test_files/libs/clipboard/clipboard.min.js"></script>
<script src="test_files/libs/quarto-html/quarto.js"></script>
<script src="test_files/libs/quarto-html/popper.min.js"></script>
<script src="test_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="test_files/libs/quarto-html/anchor.min.js"></script>
<link href="test_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="test_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="test_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="test_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="test_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ECE59500RL HW1</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Robert (Cars) Chandler – chandl71@purdue.edu </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="problem-1" class="level2">
<h2 class="anchored" data-anchor-id="problem-1">Problem 1</h2>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section">1.1</h3>
<section id="property-1" class="level4">
<h4 class="anchored" data-anchor-id="property-1">Property 1</h4>
<p>Proving the first property of a norm over a vector space for <span class="math inline">\(\Vert \mathbf{x}
\Vert_\infty\)</span>, we first recall that the L-<span class="math inline">\(\infty\)</span> norm of a vector is defined as the element in the vector with the maximum absolute value. As such,</p>
<p><span class="math display">\[
\Vert \mathbf{x} \Vert_\infty \ge 0, \quad \forall \mathbf{x} \in \mathbb{R}^n
\]</span></p>
<p>since the norm must be an absolute value of some real element, so it must be at least zero:</p>
<p><span class="math display">\[
| r | \ge 0, \quad \forall r \in \mathbb{R}
\]</span></p>
<p>Additionally,</p>
<p><span class="math display">\[
\Vert \mathbf{x} \Vert_\infty = 0 \iff \mathbf{x} = \mathbf{0}
\]</span></p>
<p>Since the only number in <span class="math inline">\(\mathbb{R}\)</span> that has an absolute value of <span class="math inline">\(0\)</span> is <span class="math inline">\(0\)</span>, so for the maximum absolute value (the L-<span class="math inline">\(\infty\)</span> norm) to be 0, all elements of <span class="math inline">\(\mathbf{x}\)</span> must be <span class="math inline">\(0\)</span>.</p>
</section>
<section id="property-2" class="level4">
<h4 class="anchored" data-anchor-id="property-2">Property 2</h4>
<p>To prove the second property, we begin with <span class="math inline">\(\Vert \mathbf{\alpha x}
\Vert_\infty\)</span>, which is the element of the vector <span class="math inline">\(\alpha \mathbf{x}\)</span> with the maximum absolute value. Each element of <span class="math inline">\(\alpha \mathbf{x}\)</span> is <span class="math inline">\(\alpha x_i\)</span>, and it holds that</p>
<p><span class="math display">\[
| \alpha r | = | \alpha | |r|, \quad \forall r \in \mathbb{R}
\]</span></p>
<p>So we can say that the maximum absolute value of <span class="math inline">\(\alpha \mathbf{x}\)</span> is equal to the maximum absolute value of <span class="math inline">\(\mathbf{x}\)</span> multiplied by <span class="math inline">\(| \alpha |\)</span>:</p>
<p><span class="math display">\[
\Vert \mathbf{\alpha x} \Vert_\infty = |\alpha| \Vert \mathbf{x} \Vert _\infty,
\quad \forall \mathbf{x} \in \mathbb{R}^n, \alpha \in \mathbb{R}
\]</span></p>
</section>
<section id="property-3" class="level4">
<h4 class="anchored" data-anchor-id="property-3">Property 3</h4>
<p>To prove the third property, we begin with <span class="math inline">\(\Vert \mathbf{x}_1 + \mathbf{x}_2
\Vert _\infty\)</span>, which is the maximum absolute value of the vector <span class="math inline">\(\mathbf{x}_1
+ \mathbf{x}_2\)</span>. The maximum absolute value of the element-wise sum of two vectors is maximized when the two elements with the largest magnitude in each vector share the same index:</p>
<p><span class="math display">\[
\max \left( \Vert \mathbf{x}_1 + \mathbf{x}_2 \Vert _\infty \right) = \Vert
\mathbf{x}_1 \Vert_\infty  + \Vert \mathbf{x}_2 \Vert_\infty
\]</span></p>
<p>Since this is the maximum value of the LHS, in any other case, we can say that the sum on the right-hand side must be greater than <span class="math inline">\(\Vert
\mathbf{x}_1 + \mathbf{x}_2 \Vert _\infty\)</span>.</p>
<p>So we can say that the maximum absolute value of <span class="math inline">\(\mathbf{x}_1 + \mathbf{x}_2\)</span> is less than or equal to the sum of the maximum absolute values of <span class="math inline">\(\mathbf{x}_1\)</span> and <span class="math inline">\(\mathbf{x}_2\)</span>:</p>
<p><span class="math display">\[
\Vert \mathbf{x}_1 + \mathbf{x}_2 \Vert _\infty \le \Vert
\mathbf{x}_1 \Vert_\infty  + \Vert \mathbf{x}_2 \Vert_\infty , \quad \forall
\mathbf{x}_1, \mathbf{x}_2 \in \mathbb{R}^n
\]</span></p>
</section>
</section>
<section id="section-1" class="level3">
<h3 class="anchored" data-anchor-id="section-1">1.2</h3>
<p>Comparing the L1 and L2 norms, we can square each one to compare them more directly:</p>
<p><span class="math display">\[
\Vert \mathbf{x} \Vert_2^2 = \left(\sqrt{\sum_{i=1}^N | x_i |^2 } \right)^2 = \sum_{i=1}^N | x_i |^2
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\Vert \mathbf{x} \Vert_1^2 = \left(\sum_{i=1}^N | x_i | \right)^2 =
\sum_{i=1}^N |x_i|^2 + 2 * \sum_{i &lt; j} | x_i | |x_j|
\]</span></p>
<p>We can compare the results of these equations directly, and it is apparent that the L1 norm squared has an additional, nonnegative term added, so it must be greater than or equal to the L2 norm squared:</p>
<p><span class="math display">\[
\Vert \mathbf{x} \Vert_1^2 =
\sum_{i=1}^N |x_i|^2 + 2 * \sum_{i &lt; j} | x_i | |x_j| \ge
\sum_{i=1}^N | x_i |^2 =
\Vert \mathbf{x} \Vert_2^2
\]</span></p>
<p>This implies that</p>
<p><span class="math display">\[
\Vert \mathbf{x} \Vert_1 \ge \Vert \mathbf{x} \Vert_2
\]</span></p>
<p>If we then compare the square L2 norm to the square of the L-<span class="math inline">\(\infty\)</span> norm:</p>
<p><span class="math display">\[
\Vert \mathbf{x} \Vert_\infty^2 = \left( \max \{ |x_1|, ..., |x_n| \} \right)^2
\le \sum_{i=1}^N | x_i |^2
= \Vert \mathbf{x} \Vert_2^2
\]</span></p>
<p>since the square of any one element of a vector of positive values must necessarily be less than or equal to a sum of the squares all of those values. This once again implies that</p>
<p><span class="math display">\[
\Vert \mathbf{x} \Vert_2 \ge  \Vert \mathbf{x} \Vert_\infty
\]</span></p>
<p>Combining this with the earlier inequality:</p>
<p><span class="math display">\[
\Vert \mathbf{x} \Vert_\infty \le
\Vert \mathbf{x} \Vert_2 \le  
\Vert \mathbf{x} \Vert_1
\]</span></p>
</section>
<section id="section-2" class="level3">
<h3 class="anchored" data-anchor-id="section-2">1.3</h3>
<p>Given vectors <span class="math inline">\(\mathbf{x}, \mathbf{y} \in \mathbb{R}^n\)</span>, the absolute value of the inner product of these vectors is:</p>
<p><span class="math display">\[
|\langle \mathbf{x}, \mathbf{y} \rangle| = \left| \sum_{i=1}^N x_i y_i \right|
\]</span></p>
<p>which, due to the properties of multiplication and absolute value, is also equivalent to</p>
<p><span class="math display">\[
\sum_{i=1}^N |x_i| |y_i|
\]</span></p>
<p>while the product of the L-<span class="math inline">\(\infty\)</span> and L1 norms is:</p>
<p><span class="math display">\[
\Vert \mathbf{x} \Vert_\infty
\Vert \mathbf{y} \Vert_1
= \max\{ |x_1|, ..., |x_n| \} \sum_{i=1}^N |y_i|
\]</span></p>
<p>If we break these down into an index-by-index basis, then for each <span class="math inline">\(i \ge 1 \in
\mathbb{N}\)</span>, it holds that</p>
<p><span class="math display">\[
|x_i| |y_i| \le x_{\text{absmax}} |y_i|
\]</span></p>
<p>and therefore this also holds across the aggregation of these indices into a sum:</p>
<p><span class="math display">\[
\sum_{i=1}^N |x_i| |y_i| \le \max\{ |x_1|, ..., |x_n| \} \sum_{i=1}^N |y_i|
\]</span></p>
<p>which is equivalent to</p>
<p><span class="math display">\[
| \langle \mathbf{x}, \mathbf{y} \rangle | \le \Vert \mathbf{x} \Vert_\infty \Vert \mathbf{y} \Vert_1
\]</span></p>
</section>
</section>
<section id="problem-2" class="level2">
<h2 class="anchored" data-anchor-id="problem-2">Problem 2</h2>
<section id="section-3" class="level3">
<h3 class="anchored" data-anchor-id="section-3">2.1</h3>
<p>We can start with the definition of <span class="math inline">\(\mathbb{E}_X[X]\)</span>, introduce a marginal sum over <span class="math inline">\(Y\)</span>, turn this into a conditional probability sum, rearrange the sums to form an expectation over <span class="math inline">\(Y\)</span>, and finally form a marginal expectation over <span class="math inline">\(X|Y\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}_X[X] &amp;= \sum_{x \in \mathcal{X}} x \mathbb{P}(X=x) \\
&amp;= \sum_{x \in \mathcal{X}} x \sum_{y \in \mathcal{Y}} \mathbb{P}(X=x , Y=y) \\
&amp;= \sum_{x \in \mathcal{X}} \sum_{y \in \mathcal{Y}} x \mathbb{P}(X=x , Y=y) \\
&amp;= \sum_{x \in \mathcal{X}} \sum_{y \in \mathcal{Y}} x \mathbb{P}(X=x | Y=y)  \mathbb{P}(Y=y) \\
&amp;= \sum_{y \in \mathcal{Y}} \left( \sum_{x \in \mathcal{X}} x \mathbb{P}(X=x | Y=y) \right) \mathbb{P}(Y=y) \\
&amp;= \mathbb{E}_Y\left[ \sum_{x \in \mathcal{X}} x \mathbb{P}(X=x | Y) \right] \\
&amp;= \mathbb{E}_Y[\mathbb{E}_X[X|Y]]
\end{aligned}
\]</span></p>
</section>
<section id="section-4" class="level3 proof">
<h3 class="proof anchored" data-anchor-id="section-4">2.2</h3>
<p>We can follow the same pattern as before, but with the continuous equivalents of the discrete operations, i.e.&nbsp;integrals instead of sums, pdfs instead of pmfs:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}_X[X] &amp;= \int_{X} x f_X(x) \, dx \\
&amp;= \int_{X} x \left( \int_{Y} f_{XY}(x, y) \, dy \right) \, dx \\
&amp;= \int_{Y} \int_{X} x f_{XY}(x, y) \, dx \, dy \\
&amp;= \int_{Y} \int_{X} x f_{X|Y}(x|y) f_Y(y)\, dx \, dy \\
&amp;= \int_{Y} \left( \int_{X} x f_{X|Y}(x|y) \, dx \right) f_Y(y) \, dy \\
&amp;= \mathbb{E}_Y\left[ \int_{X} x f_{X|Y}(x|y) \, dx \right] \\
&amp;= \mathbb{E}_Y[\mathbb{E}_X[X|Y]]
\end{aligned}
\]</span></p>
</section>
<section id="section-5" class="level3">
<h3 class="anchored" data-anchor-id="section-5">2.3</h3>
<p><span class="math inline">\(\mathbb{E}_R\left[ R_t | S_t = s, A_t = a \right]\)</span> with a stationary policy <span class="math inline">\(\pi(a|s)\)</span> applied specifies which action will be taken, thus lifting the need to specify <span class="math inline">\(\mathcal{A}\)</span> from the model, so we are left with:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}_R\left[ R_t | S_t = s \right] &amp;= \mathbb{E}_\mathcal{A} \left[ \mathbb{E}_R
\left[ R_t |  A_t = a, S_t = s \right] | S_t = s \right] \\
&amp;= \mathbb{E}_\mathcal{A} \left[ \bar{R}(s, a) | S_t = s \right] \\
&amp;= \sum_{a \in \mathcal{A}} \pi(a|s) \bar{R}(s, a) \\
\end{aligned}
\]</span></p>
</section>
</section>
<section id="problem-3" class="level2">
<h2 class="anchored" data-anchor-id="problem-3">Problem 3</h2>
<section id="section-6" class="level3">
<h3 class="anchored" data-anchor-id="section-6">3.1</h3>
<p>The state space is</p>
<p><span class="math display">\[
\mathcal{S} = \{ \text{Country}, \text{Jazz}, \text{Rock} \}
\]</span></p>
<p>The initial distribution is the following discrete probability distribution vector, where the indices are in the order Country, Jazz, Rock:</p>
<p><span class="math display">\[
\mu_0 = \{ 0, 1, 0 \}
\]</span></p>
<p>The transition matrix, with rows and columns in the order Country, Jazz, Rock, is:</p>
<p><span class="math display">\[
P = \begin{bmatrix}
0 &amp; 0.5 &amp; 0.5 \\
0.3 &amp; 0.1 &amp; 0.6 \\
0.2 &amp; 0 &amp; 0.8 \\
\end{bmatrix}
\]</span></p>
</section>
</section>
<section id="section-7" class="level2">
<h2 class="anchored" data-anchor-id="section-7">3.2</h2>
<p>Let <span class="math inline">\(C, J, R\)</span> be the states corresponding to the respective genres. The probability of starting with Jazz each time is <span class="math inline">\(1\)</span>, so we just represent our initial state in probability space with a <span class="math inline">\(1\)</span> and we multiply the probability of each transition after that.</p>
<section id="a" class="level3">
<h3 class="anchored" data-anchor-id="a">3.2.a</h3>
<p>The probability of transitioning from Country to Country <span class="math inline">\(\mathbb{P}(C | C) =
0\)</span>, so the probability of the sequence is <span class="math inline">\(0\)</span>.</p>
</section>
<section id="b" class="level3">
<h3 class="anchored" data-anchor-id="b">3.2.b</h3>
<p><span class="math display">\[
1 \cdot \mathbb{P}(J | R) \mathbb{P}(R | R) \mathbb{P}(C | R) \mathbb{P} (J | C)
= 1 \cdot 0.6 \cdot 0.8 \cdot 0.2 \cdot 0.5 = 0.048
\]</span></p>
</section>
<section id="c" class="level3">
<h3 class="anchored" data-anchor-id="c">3.2.c</h3>
<p><span class="math display">\[
\begin{aligned}
&amp;1 \cdot \mathbb{P}(J | R) \mathbb{P}(C | R) \mathbb{P}(R | C) \mathbb{P} (C | R)
\ldots \mathbb{P}(R | C) \mathbb{P}(C | R) \\
= &amp;\mathbb{P}(J | R) \prod_{i=1}^m \mathbb{P}(C | R)  \prod_{i=1}^{m-1} \mathbb{P}(R | C) \\
= &amp;\mathbb{P}(J | R) \mathbb{P}(C | R)^m  \mathbb{P}(R | C)^{m-1} \\
= &amp;0.6 \cdot 0.2^m  0.5^{m-1} \\
\end{aligned}
\]</span></p>
</section>
<section id="d" class="level3">
<h3 class="anchored" data-anchor-id="d">3.2.d</h3>
<p>As the final product repeats more and more as <span class="math inline">\(m\)</span> approaches infinity, the product will approach <span class="math inline">\(0\)</span> since the fractions raised to the <span class="math inline">\(m\)</span> and <span class="math inline">\(m-1\)</span> power will both approach <span class="math inline">\(0\)</span> since they are less than one and raised to an infinite power.</p>
</section>
</section>
<section id="section-8" class="level2">
<h2 class="anchored" data-anchor-id="section-8">3.3</h2>
<p>We can find this using the transition matrix raised to the <span class="math inline">\(t=2\)</span> power:</p>
<div id="a2f286c8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>mu0 <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>trans_matrix <span class="op">=</span> np.array([</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">0</span> , <span class="fl">0.5</span> , <span class="fl">0.5</span>],</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  [<span class="fl">0.3</span> , <span class="fl">0.1</span> , <span class="fl">0.6</span>],</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  [<span class="fl">0.2</span> , <span class="dv">0</span> , <span class="fl">0.8</span> ],</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>mu2 <span class="op">=</span> mu0 <span class="op">@</span> np.linalg.matrix_power(trans_matrix, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math display">\[
\mu_0 P^2 = \begin{bmatrix}0 &amp; 1 &amp; 0\end{bmatrix}
\begin{bmatrix}
0 &amp; 0.5 &amp; 0.5 \\
0.3 &amp; 0.1 &amp; 0.6 \\
0.2 &amp; 0 &amp; 0.8 \\
\end{bmatrix}^2
=[0.15, 0.16, 0.69]
\]</span></p>
<p>Where the entries in the vector correspond to the probability of playing Country, Jazz, and Rock at <span class="math inline">\(t=2\)</span>, respectively.</p>
</section>
<section id="section-9" class="level2">
<h2 class="anchored" data-anchor-id="section-9">3.4</h2>
<p>We can calculate the steady-state distribution <span class="math inline">\(\bar{\mu}\)</span> using a similar code as above, repeatedly applying the transition matrix until some convergence threshold is met. We will set the steady-state condition to be reached when a difference of less than 1e-8 is reached for all values in the distribution:</p>
<div id="1b6a64b4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>state_distribution <span class="op">=</span> mu0</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>difference_criterion <span class="op">=</span> <span class="fl">1e-8</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(<span class="va">True</span>):</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  t <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  old_state_distribution <span class="op">=</span> state_distribution.copy()</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  state_distribution <span class="op">=</span> state_distribution <span class="op">@</span> trans_matrix</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> np.<span class="bu">all</span>(np.<span class="bu">abs</span>(state_distribution <span class="op">-</span> old_state_distribution) <span class="op">&lt;</span> difference_criterion):</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The steady-state distribution is approximately <span class="math display">\[
\bar{\mu} = [0.17475728268372306, 0.09708737729711538, 0.7281553400191617]
\]</span></p>
<p>and the convergence criterion is met at time <span class="math inline">\(t = 17\)</span>.</p>
</section>
<section id="section-10" class="level2">
<h2 class="anchored" data-anchor-id="section-10">3.5</h2>
<p>We first re-define our stationary distribution since the new requirement is to extend to 100 timesteps, which is further than the previous convergence condition reached. We set it to be the distribution at <span class="math inline">\(t=110\)</span> since this is past the final value required for plotting and the distribution should be effectively unchanging at this point.</p>
<div id="2893f03e" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>steady_state <span class="op">=</span> mu0 <span class="op">@</span> np.linalg.matrix_power(trans_matrix, <span class="dv">110</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>trans_matrices <span class="op">=</span> np.array([np.linalg.matrix_power(trans_matrix, i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">101</span>)])</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>l1_norms <span class="op">=</span> np.linalg.norm(mu0 <span class="op">@</span> trans_matrices <span class="op">-</span> steady_state, <span class="bu">ord</span><span class="op">=</span><span class="dv">1</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>ax.plot(l1_norms)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"t"</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="vs">r"$\Vert \mu_t - \bar{\mu} \Vert_1$"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="test_files/figure-html/cell-4-output-1.png" width="600" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="section-11" class="level2">
<h2 class="anchored" data-anchor-id="section-11">3.6</h2>
<p>Based on the steady-state distribution, we expect Rock to be played most often, because given any sufficiently large <span class="math inline">\(t\)</span>-value, the probability of the state being Rock is fixed and is much higher than the other two states. This makes sense given that Rock has such a high probability of transitioning to itself.</p>
</section>
<section id="problem-4" class="level2">
<h2 class="anchored" data-anchor-id="problem-4">Problem 4</h2>
<section id="section-12" class="level3">
<h3 class="anchored" data-anchor-id="section-12">4.1</h3>
<p>We can prove this by induction.</p>
<p>The <em>induction hypothesis</em> is:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\mathbb{P}[X_{t+1}, X_{t+2}, \ldots, X_{t+m} | X_0, X_1, \ldots, X_t] \\
= &amp;\mathbb{P}[X_{t+1}, X_{t+2}, \ldots, X_{t+m} | X_t], \quad \forall t \in
\mathbb{N}_0, \forall m \in \mathbb{N}
\end{aligned}
\]</span></p>
<p>We assume this hypothesis to be correct for some value <span class="math inline">\(m \in \mathbb{N}\)</span>. Given that the MC satisfies the Markov property, the following <em>base case</em> holds for <span class="math inline">\(m=1\)</span>:</p>
<p><span class="math display">\[
\mathbb{P}[X_{t+1} | X_0, X_1, \ldots, X_t] = \mathbb{P}[X_{t+1} | X_t]
\]</span></p>
<p>In the <em>induction step</em>, we will show that the hypothesis is also correct for <span class="math inline">\(m+1\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\mathbb{P}[X_{t+1}, X_{t+2}, \ldots, X_{t+m}, X_{t+m+1} | X_0, X_1, \ldots, X_t] \\
= &amp;\mathbb{P}[X_{t+1}, X_{t+2}, \ldots, X_{t+m}, X_{t+m+1} | X_t], \quad \forall t \in
\mathbb{N}_0, \forall m \in \mathbb{N}
\end{aligned}
\]</span></p>
<p>We can start with the LHS of this equation and use the definition of conditional probability (or the “chain rule” or “product rule” if you prefer) to write it as the product of two conditional probabilities, “pulling out” the last event <span class="math inline">\(X_{t+m+1}\)</span>. If we take the form <span class="math inline">\(P(A, B) = P(B | A) P(A)\)</span>, then for our scenario <span class="math inline">\(A = X_{t+1}, ..., X_{t+m}\)</span> and <span class="math inline">\(B = X_{t+m+1}\)</span> and <span class="math inline">\(P = P(\cdot | X_0,
..., X_t)\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\mathbb{P}[X_{t+1}, X_{t+2}, \ldots, X_{t+m}, X_{t+m+1} | X_0, X_1, \ldots, X_t] \\
= &amp;\mathbb{P}[X_{t+m+1} | X_0, X_1, \ldots, X_t, X_{t+1}, \ldots, X_{t + m}] \cdot
\mathbb{P}[X_{t+1}, X_{t+2}, \ldots, X_{t+m} | X_0, X_1, \ldots, X_t] \\
= &amp;\mathbb{P}[X_{t+m+1} | X_0, X_1, \ldots, X_{t + m}] \cdot
\mathbb{P}[X_{t+1}, X_{t+2}, \ldots, X_{t+m} | X_0, X_1, \ldots, X_t] \\
\end{aligned}
\]</span></p>
<p>We can use the induction hypothesis, which is already assumed to be true, to rewrite the second term:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\mathbb{P}[X_{t+m+1} | X_0, X_1, \ldots, X_{t + m}] \cdot
\mathbb{P}[X_{t+1}, X_{t+2}, \ldots, X_{t+m} | X_0, X_1, \ldots, X_t] \\
= &amp;\mathbb{P}[X_{t+m+1} | X_0, X_1, \ldots, X_{t + m}] \cdot
\mathbb{P}[X_{t+1}, X_{t+2}, \ldots, X_{t+m} | X_t]
\end{aligned}
\]</span></p>
<p>We want to use the definition of conditional probability once more to pull these two terms back together into a single conditional probability, but the condition of the first term is not quite right. However, because of the Markov property, it is true that:</p>
<p><span class="math display">\[
\mathbb{P}[X_{t+m+1} | X_{0}, X_{1} \ldots, X_{t + m}] = \mathbb{P}[X_{t+m+1} | X_{t + m}]
\]</span></p>
<p>and it is also true that</p>
<p><span class="math display">\[
\mathbb{P}[X_{t+m+1} | X_{t}, X_{t+1} \ldots, X_{t + m}] = \mathbb{P}[X_{t+m+1} | X_{t + m}]
\]</span></p>
<p>so we can equate these two by the transitive property:</p>
<p><span class="math display">\[
\mathbb{P}[X_{t+m+1} | X_{0}, X_{1} \ldots, X_{t + m}] =
\mathbb{P}[X_{t+m+1} | X_{t}, X_{t+1} \ldots, X_{t + m}]
\]</span></p>
<p>So we can substitute this term in the original equation and use the definition of conditional probability to join the two terms back together:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\mathbb{P}[X_{t+m+1} | X_{0}, X_{1}, \ldots, X_{t + m}] \cdot
\mathbb{P}[X_{t+1}, X_{t+2}, \ldots, X_{t+m} | X_t] \\
=&amp;\mathbb{P}[X_{t+m+1} | X_{t}, X_{t+1}, \ldots, X_{t + m}] \cdot
\mathbb{P}[X_{t+1}, X_{t+2}, \ldots, X_{t+m} | X_t] \\
=&amp;\frac{\mathbb{P}[X_t, X_{t+1}, \ldots, X_{t+m+1}]}{X_t, X_{t+1}, \ldots, X_{t+m}}
\frac{X_t, X_{t+1}, \ldots, X_{t+m}}{X_t} \\
=&amp;\frac{\mathbb{P}[X_t, X_{t+1}, \ldots, X_{t+m+1}]}{X_t} \\
=&amp; \mathbb{P}[X_{t+1}, X_{t+2}, \ldots, X_{t+m+1} | X_t] \\
\end{aligned}
\]</span></p>
<p>So, we have proven the induction step, therefore the hypothesis holds for all <span class="math inline">\(m \in \mathbb{N}\)</span>, and the induction hypothesis is proven:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\mathbb{P}[X_{t+1}, X_{t+2}, \ldots, X_{t+m} | X_0, X_1, \ldots, X_t] \\
= &amp;\mathbb{P}[X_{t+1}, X_{t+2}, \ldots, X_{t+m} | X_t], \quad \forall t \in
\mathbb{N}_0, \forall m \in \mathbb{N} &amp; \blacksquare \\
\end{aligned}
\]</span></p>
</section>
<section id="section-13" class="level3">
<h3 class="anchored" data-anchor-id="section-13">4.2</h3>
<p>We wish to prove that the following holds:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\mathbb{P}[X_{t+k}, X_{t+k+1}, \ldots, X_{t+m} | X_0, X_1, \ldots, X_t] \\
= &amp;\mathbb{P}[X_{t+k}, X_{t+k+1}, \ldots, X_{t+m} | X_t], \quad \forall t \in
\mathbb{N}_0, \forall k,m \in \mathbb{N}, m \ge k
\end{aligned}
\]</span></p>
<p>In the case where <span class="math inline">\(k=1\)</span>, the equation is equivalent to the one we proved in <a href="#section-12">4.1</a>, so it holds.</p>
<p>In all other cases where <span class="math inline">\(1 &lt; k \le m\)</span>, the probability of the next state <span class="math inline">\(X_{t+k}\)</span> is dependent only on the state before it <span class="math inline">\(X_{t + k - 1}\)</span> due to the Markov property. However, if <span class="math inline">\(1 &lt; k \le m\)</span>, then the previous state <span class="math inline">\(X_{t+k-1}\)</span> cannot be equal to <span class="math inline">\(X_t\)</span>. This is to say that if <span class="math inline">\(X_{t+k}\)</span> is the next “future” state, then it is only dependent on <span class="math inline">\(X_{t+k-1}\)</span>, which is the “current” state, but <span class="math inline">\(X_t\)</span> is necessarily a “past” state. <span class="math inline">\(X_t\)</span> is the most current state on which the conditional probability in the equation is defined, so all we have is past information, which is all the same in that it does not inform us about the probability of the next state. So for all valid <span class="math inline">\(k\)</span> other than <span class="math inline">\(k=1\)</span>, the probability of future states conditioned on past information from <span class="math inline">\(t=0\)</span> to <span class="math inline">\(t=t\)</span> is equivalent to the probability of those future states conditioned only on <span class="math inline">\(X_t\)</span> since they are all past information and therefore are all equally uninformative. So it holds that</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\mathbb{P}[X_{t+k}, X_{t+k+1}, \ldots, X_{t+m} | X_0, X_1, \ldots, X_t] \\
= &amp;\mathbb{P}[X_{t+k}, X_{t+k+1}, \ldots, X_{t+m} | X_t], \quad \forall t \in
\mathbb{N}_0, \forall k,m \in \mathbb{N}, m \ge k
\end{aligned}
\]</span></p>
</section>
</section>
<section id="problem-5" class="level2">
<h2 class="anchored" data-anchor-id="problem-5">Problem 5</h2>
<section id="section-14" class="level3">
<h3 class="anchored" data-anchor-id="section-14">5.1</h3>
<p>We assume that the state <span class="math inline">\((i, j)\)</span> represents the previous two states in <span class="math inline">\(X_{t-2}, X_{t-1}\)</span> order, such that a sequence <span class="math inline">\(2, 1, 2\)</span> in the second-order model can be represented by a sequence <span class="math inline">\((2, 1), (1, 2)\)</span> in the simple MC.</p>
<p>Using the transition from <span class="math inline">\((1, 1)\)</span> to <span class="math inline">\((1, 1)\)</span> as an example, the probability of this transition is found from the given probability:</p>
<p><span class="math display">\[
\mathcal{P}((1,1)|(1,1)) = \mathcal{P}(X_t = 1 | X_{t-2} = 1, X_{t-1} = 1) = 0.8
\]</span></p>
<p>and we can use the complement to define the probability of <span class="math inline">\((1,1)\)</span> to <span class="math inline">\((1,2)\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\mathcal{P}((1,2)|(1,1)) &amp;= \mathcal{P}(X_t = 2 | X_{t-2} = 1, X_{t-1} = 1) \\
&amp;= 1 - \mathcal{P}(X_t = 1 | X_{t-2} = 1, X_{t-1} = 1) \\
&amp;= 0.2
\end{aligned}
\]</span></p>
<p>We repeat this across all combinations:</p>
<p><span class="math display">\[
\begin{aligned}
\mathcal{P}((1,1)|(1,1)) &amp;= \mathcal{P}(X_t = 1 | X_{t-2} = 1, X_{t-1} = 1) = 0.8 \\
\mathcal{P}((1,2)|(1,1)) &amp;= 1 - \mathcal{P}(X_t = 2 | X_{t-2} = 1, X_{t-1} = 1) = 0.2 \\
\mathcal{P}((2,1)|(1,2)) &amp;= \mathcal{P}(X_t = 1 | X_{t-2} = 1, X_{t-1} = 2) = 0.1 \\
\mathcal{P}((2,2)|(1,2)) &amp;= 1 - \mathcal{P}(X_t = 2 | X_{t-2} = 1, X_{t-1} = 1) = 0.9 \\
\mathcal{P}((1,1)|(2,1)) &amp;= \mathcal{P}(X_t = 1 | X_{t-2} = 2, X_{t-1} = 1) = 0.3 \\
\mathcal{P}((1,2)|(2,1)) &amp;= 1 - \mathcal{P}(X_t = 2 | X_{t-2} = 2, X_{t-1} = 1) = 0.7 \\
\mathcal{P}((2,1)|(2,2)) &amp;= \mathcal{P}(X_t = 1 | X_{t-2} = 2, X_{t-1} = 2) = 0.7 \\
\mathcal{P}((2,2)|(2,2)) &amp;= 1 - \mathcal{P}(X_t = 2 | X_{t-2} = 2, X_{t-1} = 2) = 0.3 \\
\end{aligned}
\]</span></p>
<p>Which, in graph form, looks like:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-graph-p5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graph-p5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<svg width="672" height="480" viewbox="0.00 0.00 258.77 310.40" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 306.4)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-306.4 254.77,-306.4 254.77,4 -4,4"></polygon>
<!-- 1 -->
<g id="node1" class="node">
<title>1</title>
<ellipse fill="none" stroke="black" cx="183.31" cy="-284.4" rx="31.91" ry="18"></ellipse>
<text text-anchor="middle" x="183.31" y="-280.2" font-family="Times,serif" font-size="14.00">(1, 1)</text>
</g>
<!-- 1&#45;&gt;1 -->
<g id="edge1" class="edge">
<title>1-&gt;1</title>
<path fill="none" stroke="black" d="M211.81,-292.59C223.45,-293.1 233.27,-290.37 233.27,-284.4 233.27,-280.29 228.63,-277.72 221.94,-276.68"></path>
<polygon fill="black" stroke="black" points="221.96,-273.18 211.81,-276.21 221.64,-280.17 221.96,-273.18"></polygon>
<text text-anchor="middle" x="242.02" y="-280.2" font-family="Times,serif" font-size="14.00">0.8</text>
</g>
<!-- 2 -->
<g id="node2" class="node">
<title>2</title>
<ellipse fill="none" stroke="black" cx="109.31" cy="-195.6" rx="31.91" ry="18"></ellipse>
<text text-anchor="middle" x="109.31" y="-191.4" font-family="Times,serif" font-size="14.00">(1, 2)</text>
</g>
<!-- 1&#45;&gt;2 -->
<g id="edge2" class="edge">
<title>1-&gt;2</title>
<path fill="none" stroke="black" d="M170.08,-267.88C158.79,-254.63 142.37,-235.37 129.44,-220.21"></path>
<polygon fill="black" stroke="black" points="131.83,-217.62 122.68,-212.28 126.5,-222.16 131.83,-217.62"></polygon>
<text text-anchor="middle" x="161.06" y="-235.8" font-family="Times,serif" font-size="14.00">0.2</text>
</g>
<!-- 3 -->
<g id="node3" class="node">
<title>3</title>
<ellipse fill="none" stroke="black" cx="141.31" cy="-18" rx="31.91" ry="18"></ellipse>
<text text-anchor="middle" x="141.31" y="-13.8" font-family="Times,serif" font-size="14.00">(2, 1)</text>
</g>
<!-- 2&#45;&gt;3 -->
<g id="edge3" class="edge">
<title>2-&gt;3</title>
<path fill="none" stroke="black" d="M84.44,-184.21C46.49,-166.77 -19,-129.5 5.81,-88.8 26.51,-54.86 69.58,-36.71 101.64,-27.52"></path>
<polygon fill="black" stroke="black" points="102.87,-30.81 111.62,-24.84 101.05,-24.05 102.87,-30.81"></polygon>
<text text-anchor="middle" x="15.06" y="-102.6" font-family="Times,serif" font-size="14.00">0.1</text>
</g>
<!-- 4 -->
<g id="node4" class="node">
<title>4</title>
<ellipse fill="none" stroke="black" cx="64.31" cy="-106.8" rx="31.91" ry="18"></ellipse>
<text text-anchor="middle" x="64.31" y="-102.6" font-family="Times,serif" font-size="14.00">(2, 2)</text>
</g>
<!-- 2&#45;&gt;4 -->
<g id="edge4" class="edge">
<title>2-&gt;4</title>
<path fill="none" stroke="black" d="M100.64,-177.86C94.06,-165.17 84.9,-147.52 77.43,-133.11"></path>
<polygon fill="black" stroke="black" points="80.52,-131.46 72.81,-124.19 74.31,-134.68 80.52,-131.46"></polygon>
<text text-anchor="middle" x="99.06" y="-147" font-family="Times,serif" font-size="14.00">0.9</text>
</g>
<!-- 3&#45;&gt;1 -->
<g id="edge5" class="edge">
<title>3-&gt;1</title>
<path fill="none" stroke="black" d="M150.23,-35.41C153.1,-41.16 156.11,-47.76 158.31,-54 163.59,-68.97 163.84,-73.12 166.31,-88.8 175.67,-148.1 180.22,-218.44 182.13,-256.2"></path>
<polygon fill="black" stroke="black" points="178.64,-256.56 182.62,-266.38 185.63,-256.23 178.64,-256.56"></polygon>
<text text-anchor="middle" x="183.06" y="-147" font-family="Times,serif" font-size="14.00">0.3</text>
</g>
<!-- 3&#45;&gt;2 -->
<g id="edge6" class="edge">
<title>3-&gt;2</title>
<path fill="none" stroke="black" d="M143.26,-36.09C145.18,-57.21 146.97,-94.1 140.31,-124.8 136.97,-140.19 130.06,-156.31 123.61,-169.19"></path>
<polygon fill="black" stroke="black" points="120.36,-167.85 118.84,-178.33 126.57,-171.09 120.36,-167.85"></polygon>
<text text-anchor="middle" x="153.06" y="-102.6" font-family="Times,serif" font-size="14.00">0.7</text>
</g>
<!-- 4&#45;&gt;3 -->
<g id="edge7" class="edge">
<title>4-&gt;3</title>
<path fill="none" stroke="black" d="M78.08,-90.28C90.01,-76.83 107.45,-57.17 120.99,-41.91"></path>
<polygon fill="black" stroke="black" points="123.65,-44.19 127.67,-34.38 118.41,-39.54 123.65,-44.19"></polygon>
<text text-anchor="middle" x="118.06" y="-58.2" font-family="Times,serif" font-size="14.00">0.7</text>
</g>
<!-- 4&#45;&gt;4 -->
<g id="edge8" class="edge">
<title>4-&gt;4</title>
<path fill="none" stroke="black" d="M92.81,-114.99C104.45,-115.5 114.27,-112.77 114.27,-106.8 114.27,-102.69 109.63,-100.12 102.94,-99.08"></path>
<polygon fill="black" stroke="black" points="102.96,-95.58 92.81,-98.61 102.64,-102.57 102.96,-95.58"></polygon>
<text text-anchor="middle" x="123.02" y="-102.6" font-family="Times,serif" font-size="14.00">0.3</text>
</g>
</g>
</svg>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graph-p5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Model Transition Graph
</figcaption>
</figure>
</div>
</div>
</div>
<p>To find the initial state distribution, we take the probabilities of getting all <span class="math inline">\(2 \cdot 2 = 4\)</span> possibilities of the first two states using the probabilities in the problem statement.</p>
<p>The first-order initial distribution is:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{P}_1(X_0 = 1) &amp;= 0.5 \\
\mathbb{P}_1(X_0 = 2) &amp;= 0.5 \\
\end{aligned}
\]</span></p>
<p>Where <span class="math inline">\(\mathbb{P}_1\)</span> indicates that the probability measure is acting on the first-order model’s state space.</p>
<p>Using this, the second-order initial distribution is:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{P}_2(X_0 &amp;= (1, 1)) = \mathbb{P}_1(X_1 = 1 | X_0 = 1) \mathbb{P}_1(X_0 = 1) = 0.2 \cdot 0.5 = 0.1 \\
\mathbb{P}_2(X_0 &amp;= (2, 1)) = \mathbb{P}_1(X_1 = 1 | X_0 = 2) \mathbb{P}_1(X_0 = 2) = 0.4 \cdot 0.5 = 0.2 \\
\mathbb{P}_2(X_0 &amp;= (1, 2)) = \mathbb{P}_1(X_1 = 2 | X_0 = 1) \mathbb{P}_1(X_0 = 1) = 0.8 \cdot 0.5 = 0.4 \\
\mathbb{P}_2(X_0 &amp;= (2, 2)) = \mathbb{P}_1(X_1 = 2 | X_0 = 2) \mathbb{P}_1(X_0 = 2) = 0.6 \cdot 0.5 = 0.3 \\
\end{aligned}
\]</span></p>
<p>Where <span class="math inline">\(\mathbb{P}_2\)</span> indicates that the probability measure is acting on the second-order model’s state space.</p>
<p>Therefore:</p>
<p><span class="math display">\[
\mu_0 = [0.1, 0.2, 0.4, 0.3]
\]</span></p>
<p>for the state-space</p>
<p><span class="math display">\[
\mathcal{S} = \{(1,1), (1,2), (2,1), (2,2)\}
\]</span></p>
</section>
<section id="section-15" class="level3">
<h3 class="anchored" data-anchor-id="section-15">5.2</h3>
<p>To create a simple Markov chain from an MC of order <span class="math inline">\(k\)</span>, we first need to form a new state-space <span class="math inline">\(\mathcal{S}'\)</span> from the original space <span class="math inline">\(\mathcal{S}\)</span> where each element of <span class="math inline">\(\mathcal{S}'\)</span> is a <span class="math inline">\(k\)</span>-tuple such that all <span class="math inline">\(|\mathcal{S}|^k\)</span> combinations of <span class="math inline">\(k\)</span> values from <span class="math inline">\(\mathcal{S}\)</span> are included. The values in the tuple represent a sequence of <span class="math inline">\(k\)</span> states in the <span class="math inline">\(k\)</span>-order space from oldest to newest.</p>
<p>To form the new state transition probabilities, we take an existing <span class="math inline">\(k\)</span>-tuple from <span class="math inline">\(\mathcal{S}'\)</span> and consider a state from <span class="math inline">\(\mathcal{S}\)</span> as the next state in the sequence. We require each of the state values in the <span class="math inline">\(k\)</span>-tuple sequence to determine the probability of the next state. This probability should be given as a conditional probability in the original model, conditioned on the <span class="math inline">\(k\)</span> previous values. We assign the probability whose condition matches the order of the sequence in the tuple. We repeat this for each tuple in <span class="math inline">\(\mathcal{S}'\)</span>.</p>
<p>To form the initial distribution, we consider a tuple from <span class="math inline">\(\mathcal{S}'\)</span> and multiply out the probabilities given in the original model of obtaining each step such that the first probability is not conditioned on any former states, and each successive probability will be conditional on one additional previous state. For example, if the tuple is <span class="math inline">\((S_0, S_0, S_1)\)</span>, the first term in the product should be <span class="math inline">\(\mathbb{P}(X_0 = S_0)\)</span>, the the probability of obtaining <span class="math inline">\(S_0\)</span> on the first step. This will be multiplied by <span class="math inline">\(\mathbb{P}(X_1 = S_0 | X_0
= S_0)\)</span>, and will finally be multiplied by <span class="math inline">\(\mathbb{P}(X_2 = S_1 | X_0 = S_0,
X_1 = S_0)\)</span>. This process is repeated for each tuple in <span class="math inline">\(\mathcal{S}'\)</span>.</p>
</section>
</section>
<section id="problem-6" class="level2">
<h2 class="anchored" data-anchor-id="problem-6">Problem 6</h2>
<section id="section-16" class="level3">
<h3 class="anchored" data-anchor-id="section-16">6.1</h3>
<p>The scenario can be described as an MDP with reward defined by the tuple <span class="math inline">\(\mu =
(\mu_0, \mathcal{S}, \mathcal{A}, \mathcal{P},
\mathcal{R}, \gamma)\)</span></p>
<p>Additionally, we define the following “helper” sets and a function to map between the movies available and the genres of those movies. We could describe all elements of the MDP without these by writing out all possible combinations, but these help to minimize the amount of writing necessary:</p>
<p><span class="math display">\[
\begin{gathered}
G = \{ A, H, C \} \\
M = \{ A, B, C, D \} \\
\mathcal{G}: M \to G^n, \quad n \in \{1, 2, 3\}
\end{gathered}
\]</span></p>
<p><span class="math inline">\(G\)</span> is the set of genres available, <span class="math inline">\(M\)</span> is the set of movies available, and <span class="math inline">\(\mathcal{G}\)</span> describes which genres apply for a given movie.</p>
<p><span class="math inline">\(\mathcal{S} = \{ s_A, s_H, s_C \}\)</span> where each state corresponds to the user’s desired genre, which is either Action, Horror, or Comedy, respectively.</p>
<p><span class="math inline">\(\mu_0 = \left[  \frac{1}{3},  \frac{1}{3},  \frac{1}{3} \right]\)</span> where the order of the indices is Action, Horror, Comedy; the same as for <span class="math inline">\(\mathcal{S}\)</span>.</p>
<p><span class="math inline">\(\mathcal{A} = \{ a_A, a_B, a_C, a_D \}\)</span> which are actions corresponding to which movie the system recommends to the user.</p>
<p><span class="math inline">\(\mathcal{P} = \mathcal{P}(s, a): \mathcal{S} \times \mathcal{A} \to \Delta
(\mathcal{S})\)</span> where the function can be described piecewise as:</p>
<p><span class="math display">\[
\mathcal{P}(s, a) = \begin{cases}
\left[ 1, 0, 0 \right], s = s_A, A \notin \mathcal{G}(a) \\
\left[ 0, 1, 0 \right], s = s_H, H \notin \mathcal{G}(a) \\
\left[ 0, 0, 1 \right], s = s_C, C \notin \mathcal{G}(a) \\
\left[ 0, 0.5, 0.5 \right], s = s_A, A \in \mathcal{G}(a) \\
\left[ 0.5, 0, 0.5 \right], s = s_H, H \in \mathcal{G}(a) \\
\left[ 0.5, 0.5, 0 \right], s = s_C, C \in \mathcal{G}(a) \\
\end{cases}
\]</span></p>
<p>When the user’s genre preference is not one of the genres of the movie chosen by the previous action, the user’s genre preference remains the same with probability 1. If one of the movie’s genres is the user’s preference, then the next genre preference will be one of the other two genres with equal probability (0.5) for each genre.</p>
<p><span class="math inline">\(\mathcal{R} = \mathcal{R}(s, a): \mathcal{S} \times \mathcal{A} \to [-1, 1]\)</span></p>
<p>Where the reward function can be defined piecewise as:</p>
<p><span class="math display">\[
\mathcal{R}(s_i, a_j) = \begin{cases}
1, \quad i \in \mathcal{G}(j), i \in G, j \in M \\
-1, \quad i \notin \mathcal{G}(j), i \in G, j \in M \\
\end{cases}
\]</span></p>
<p>Which is to say that if the genre preference defined by the input state <span class="math inline">\(s_i\)</span> (where <span class="math inline">\(i\)</span> is the genre in the set of genres <span class="math inline">\(G\)</span>) is in the set of genres of the movie chosen in action <span class="math inline">\(a_j\)</span> (which is the output of the function <span class="math inline">\(\mathcal{G}(j)\)</span> where <span class="math inline">\(j\)</span> is the movie in the set of movies <span class="math inline">\(M\)</span>), then the reward will be 1, which corresponds to the user submitting a Like, and if the desired genre is <em>not</em> in the set of genres for the movie chosen, the reward is -1, corrresponding to the user submitting a Dislike.</p>
<p><span class="math inline">\(\gamma = 0.95\)</span></p>
</section>
<section id="section-17" class="level3">
<h3 class="anchored" data-anchor-id="section-17">6.2</h3>
<p>The transition-based graph of the recommendation strategy is shown below where the nodes correspond to the different states and the edges are labeled with the actions taken in the transitions they represent along with the probability of taking that respective action/transition:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-graph" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graph-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<svg width="672" height="480" viewbox="0.00 0.00 621.35 414.66" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 410.66)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-410.66 617.35,-410.66 617.35,4 -4,4"></polygon>
<!-- A -->
<g id="node1" class="node">
<title>A</title>
<ellipse fill="none" stroke="black" cx="292.85" cy="-304.26" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="292.85" y="-300.06" font-family="Times,serif" font-size="14.00">A</text>
</g>
<!-- A&#45;&gt;A -->
<g id="edge5" class="edge">
<title>A:n-&gt;A:n</title>
<path fill="none" stroke="black" d="M292.85,-322.26C317.85,-333.59 317.85,-356.26 292.85,-356.26 271.37,-356.26 268.34,-339.52 283.79,-327.62"></path>
<polygon fill="black" stroke="black" points="286.02,-330.36 292.85,-322.26 282.46,-324.33 286.02,-330.36"></polygon>
<text text-anchor="start" x="287.8" y="-394.06" font-family="Times,serif" font-size="14.00">D</text>
<text text-anchor="start" x="284.1" y="-377.26" font-family="Times,serif" font-size="14.00">0.2</text>
<text text-anchor="start" x="287.02" y="-360.46" font-family="Times,serif" font-size="14.00">-1</text>
</g>
<!-- H -->
<g id="node2" class="node">
<title>H</title>
<ellipse fill="none" stroke="black" cx="162.85" cy="-167.46" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="162.85" y="-163.26" font-family="Times,serif" font-size="14.00">H</text>
</g>
<!-- A&#45;&gt;H -->
<g id="edge1" class="edge">
<title>A:nw-&gt;H</title>
<path fill="none" stroke="black" d="M277.85,-320.26C256.33,-341.78 29.34,-284.85 10.35,-261.06 -3.62,-243.55 -3.21,-228.48 10.35,-210.66 24.35,-192.25 85.89,-179.81 126.38,-173.44"></path>
<polygon fill="black" stroke="black" points="127.07,-176.87 136.43,-171.91 126.02,-169.95 127.07,-176.87"></polygon>
<text text-anchor="start" x="14.55" y="-248.46" font-family="Times,serif" font-size="14.00">A</text>
<text text-anchor="start" x="10.85" y="-231.66" font-family="Times,serif" font-size="14.00">0.2</text>
<text text-anchor="start" x="16.1" y="-214.86" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- A&#45;&gt;H -->
<g id="edge3" class="edge">
<title>A:nw-&gt;H</title>
<path fill="none" stroke="black" d="M277.85,-320.26C274.86,-323.24 120.56,-311.98 83.35,-261.06 70.13,-242.97 71.81,-229.85 83.35,-210.66 93.11,-194.42 111.45,-184.1 128.06,-177.73"></path>
<polygon fill="black" stroke="black" points="129.27,-181.02 137.56,-174.43 126.96,-174.41 129.27,-181.02"></polygon>
<text text-anchor="start" x="87.93" y="-248.46" font-family="Times,serif" font-size="14.00">B</text>
<text text-anchor="start" x="83.85" y="-231.66" font-family="Times,serif" font-size="14.00">0.2</text>
<text text-anchor="start" x="89.1" y="-214.86" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- C -->
<g id="node3" class="node">
<title>C</title>
<ellipse fill="none" stroke="black" cx="336.85" cy="-30.66" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="336.85" y="-26.46" font-family="Times,serif" font-size="14.00">C</text>
</g>
<!-- A&#45;&gt;C -->
<g id="edge2" class="edge">
<title>A-&gt;C</title>
<path fill="none" stroke="black" d="M311.95,-291C322.05,-283.54 333.79,-273.12 340.85,-261.06 372.23,-207.41 363.37,-186.07 369.85,-124.26 372.19,-101.98 377.15,-95.03 369.85,-73.86 367.35,-66.6 363.04,-59.64 358.33,-53.54"></path>
<polygon fill="black" stroke="black" points="360.94,-51.19 351.82,-45.8 355.58,-55.7 360.94,-51.19"></polygon>
<text text-anchor="start" x="371.55" y="-180.06" font-family="Times,serif" font-size="14.00">A</text>
<text text-anchor="start" x="367.85" y="-163.26" font-family="Times,serif" font-size="14.00">0.2</text>
<text text-anchor="start" x="373.1" y="-146.46" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- A&#45;&gt;C -->
<g id="edge4" class="edge">
<title>A-&gt;C:ne</title>
<path fill="none" stroke="black" d="M319.88,-303.15C380.76,-302.27 525.7,-296.43 555.85,-261.06 609.82,-197.74 610.66,-136.45 555.85,-73.86 497.95,-7.72 422.68,-103.3 359.49,-53.47"></path>
<polygon fill="black" stroke="black" points="361.64,-50.7 351.85,-46.66 356.98,-55.92 361.64,-50.7"></polygon>
<text text-anchor="start" x="599.93" y="-180.06" font-family="Times,serif" font-size="14.00">B</text>
<text text-anchor="start" x="595.85" y="-163.26" font-family="Times,serif" font-size="14.00">0.2</text>
<text text-anchor="start" x="601.1" y="-146.46" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- H&#45;&gt;A -->
<g id="edge7" class="edge">
<title>H-&gt;A</title>
<path fill="none" stroke="black" d="M155.77,-184.97C148.39,-205.01 139.99,-238.88 156.35,-261.06 178.9,-291.64 223.34,-300.73 255.4,-303.1"></path>
<polygon fill="black" stroke="black" points="255.57,-306.62 265.74,-303.67 255.95,-299.63 255.57,-306.62"></polygon>
<text text-anchor="start" x="167.93" y="-248.46" font-family="Times,serif" font-size="14.00">B</text>
<text text-anchor="start" x="156.85" y="-231.66" font-family="Times,serif" font-size="14.00">0.125</text>
<text text-anchor="start" x="169.1" y="-214.86" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- H&#45;&gt;A -->
<g id="edge9" class="edge">
<title>H-&gt;A</title>
<path fill="none" stroke="black" d="M175.02,-183.83C190.25,-202.72 217.47,-235.42 243.35,-261.06 251.05,-268.69 259.94,-276.53 268.04,-283.35"></path>
<polygon fill="black" stroke="black" points="265.87,-286.1 275.8,-289.79 270.34,-280.71 265.87,-286.1"></polygon>
<text text-anchor="start" x="253.93" y="-248.46" font-family="Times,serif" font-size="14.00">C</text>
<text text-anchor="start" x="242.85" y="-231.66" font-family="Times,serif" font-size="14.00">0.125</text>
<text text-anchor="start" x="255.1" y="-214.86" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- H&#45;&gt;A -->
<g id="edge11" class="edge">
<title>H-&gt;A</title>
<path fill="none" stroke="black" d="M189.75,-169.92C217.7,-172.99 260.43,-182.36 282.85,-210.66 297.32,-228.92 298.67,-255.96 297.08,-276.11"></path>
<polygon fill="black" stroke="black" points="293.59,-275.91 296,-286.22 300.55,-276.65 293.59,-275.91"></polygon>
<text text-anchor="start" x="307.55" y="-248.46" font-family="Times,serif" font-size="14.00">D</text>
<text text-anchor="start" x="296.85" y="-231.66" font-family="Times,serif" font-size="14.00">0.125</text>
<text text-anchor="start" x="309.1" y="-214.86" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- H&#45;&gt;H -->
<g id="edge6" class="edge">
<title>H:ne-&gt;H:e</title>
<path fill="none" stroke="black" d="M177.85,-182.46C203.52,-199.46 239.85,-199.46 239.85,-174.96 239.85,-154.09 215.68,-151 198.21,-161.03"></path>
<polygon fill="black" stroke="black" points="195.65,-158.59 189.85,-167.46 199.91,-164.14 195.65,-158.59"></polygon>
<text text-anchor="start" x="247.05" y="-180.06" font-family="Times,serif" font-size="14.00">A</text>
<text text-anchor="start" x="239.85" y="-163.26" font-family="Times,serif" font-size="14.00">0.25</text>
<text text-anchor="start" x="246.27" y="-146.46" font-family="Times,serif" font-size="14.00">-1</text>
</g>
<!-- H&#45;&gt;C -->
<g id="edge8" class="edge">
<title>H:sw-&gt;C</title>
<path fill="none" stroke="black" d="M147.85,-151.46C123.81,-127.41 95.65,-152.25 76.35,-124.26 63.64,-105.81 61.83,-90.91 76.35,-73.86 104.55,-40.72 234.29,-33.53 299.38,-32.02"></path>
<polygon fill="black" stroke="black" points="299.7,-35.51 309.63,-31.81 299.56,-28.51 299.7,-35.51"></polygon>
<text text-anchor="start" x="87.93" y="-111.66" font-family="Times,serif" font-size="14.00">B</text>
<text text-anchor="start" x="76.85" y="-94.86" font-family="Times,serif" font-size="14.00">0.125</text>
<text text-anchor="start" x="89.1" y="-78.06" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- H&#45;&gt;C -->
<g id="edge10" class="edge">
<title>H-&gt;C</title>
<path fill="none" stroke="black" d="M174.94,-151C193.3,-127.81 227.71,-85.49 243.35,-73.86 261.52,-60.34 284.71,-49.84 303.44,-42.69"></path>
<polygon fill="black" stroke="black" points="304.87,-45.9 313.06,-39.17 302.47,-39.33 304.87,-45.9"></polygon>
<text text-anchor="start" x="253.93" y="-111.66" font-family="Times,serif" font-size="14.00">C</text>
<text text-anchor="start" x="242.85" y="-94.86" font-family="Times,serif" font-size="14.00">0.125</text>
<text text-anchor="start" x="255.1" y="-78.06" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- H&#45;&gt;C -->
<g id="edge12" class="edge">
<title>H:se-&gt;C:n</title>
<path fill="none" stroke="black" d="M177.85,-151.46C211.94,-117.37 243.03,-151.43 282.85,-124.26 297.38,-114.34 326.82,-81.49 334.81,-59.46"></path>
<polygon fill="black" stroke="black" points="338.24,-60.16 336.85,-49.66 331.38,-58.73 338.24,-60.16"></polygon>
<text text-anchor="start" x="337.55" y="-111.66" font-family="Times,serif" font-size="14.00">D</text>
<text text-anchor="start" x="326.85" y="-94.86" font-family="Times,serif" font-size="14.00">0.125</text>
<text text-anchor="start" x="339.1" y="-78.06" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- C&#45;&gt;A -->
<g id="edge14" class="edge">
<title>C-&gt;A:ne</title>
<path fill="none" stroke="black" d="M361.24,-38.82C377.88,-45.13 398.69,-56.13 408.85,-73.86 419.99,-93.29 410.47,-101.92 408.85,-124.26 404.39,-185.54 418.72,-207.36 388.85,-261.06 369.48,-295.88 335.5,-316.99 318,-320.99"></path>
<polygon fill="black" stroke="black" points="318.08,-317.49 307.85,-320.26 317.57,-324.47 318.08,-317.49"></polygon>
<text text-anchor="start" x="415.43" y="-180.06" font-family="Times,serif" font-size="14.00">C</text>
<text text-anchor="start" x="407.85" y="-163.26" font-family="Times,serif" font-size="14.00">0.45</text>
<text text-anchor="start" x="416.6" y="-146.46" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- C&#45;&gt;H -->
<g id="edge15" class="edge">
<title>C:nw-&gt;H:se</title>
<path fill="none" stroke="black" d="M321.85,-46.66C270.38,-98.13 207.35,-18.28 160.35,-73.86 145.89,-90.96 154.03,-102.77 160.35,-124.26 162.76,-132.44 172.06,-136.92 177.09,-141.32"></path>
<polygon fill="black" stroke="black" points="173.61,-141.75 177.85,-151.46 180.59,-141.22 173.61,-141.75"></polygon>
<text text-anchor="start" x="168.43" y="-111.66" font-family="Times,serif" font-size="14.00">C</text>
<text text-anchor="start" x="160.85" y="-94.86" font-family="Times,serif" font-size="14.00">0.45</text>
<text text-anchor="start" x="169.6" y="-78.06" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- C&#45;&gt;C -->
<g id="edge13" class="edge">
<title>C:s-&gt;C:se</title>
<path fill="none" stroke="black" d="M336.85,-12.66C362.52,4.34 413.85,4.34 413.85,-14.16 413.85,-30.63 385.03,-32.43 360.59,-20.62"></path>
<polygon fill="black" stroke="black" points="362.27,-17.55 351.85,-15.66 358.82,-23.64 362.27,-17.55"></polygon>
<text text-anchor="start" x="417.93" y="-43.26" font-family="Times,serif" font-size="14.00">B</text>
<text text-anchor="start" x="413.85" y="-26.46" font-family="Times,serif" font-size="14.00">0.1</text>
<text text-anchor="start" x="416.77" y="-9.66" font-family="Times,serif" font-size="14.00">-1</text>
</g>
</g>
</svg>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graph-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Model Transition Graph
</figcaption>
</figure>
</div>
</div>
</div>
<section id="sec-method" class="level4">
<h4 class="anchored" data-anchor-id="sec-method">Probability Calculations</h4>
<p>Each probability on the edges was calculated by taking the action and its corresponding probability given by the policy, determining whether the combination of the action and the state would match the user’s preference or not, and if it did match their preference, splitting the probability into two equal parts and assigning it to the two other genres, while if it did match the user’s preference, assigning the full probability to the same genre as given in the current state. For example, if the user asks for Action movies and there is a 0.4 probability that the system recommends movie A, which is an Action movie, then if the system does recommend A, the user would have a 50% chance of selecting either Horror or Comedy as the next state, so we take the 0.4 probability, multiply it by 0.5, and assign that probability to each of the transitions from <span class="math inline">\(A \to H\)</span> and <span class="math inline">\(A \to C\)</span>, marking which action was taken to get there.</p>
<p>The given policy is stationary as it only depends on the user’s current genre preference rather than their past or future ones. It is also a stochastic policy rather than a deterministic one as the action taken is chosen with some degree of randomness as indicated by the probability values on the edges/transitions in the graph.</p>
</section>
</section>
<section id="section-18" class="level3">
<h3 class="anchored" data-anchor-id="section-18">6.3</h3>
<p>With the policy in <a href="#section-17">6.2</a> prescribed, a Markov chain (with reward) is induced over the MDP from <a href="#section-16">6.1</a>. It is defined by the tuple <span class="math inline">\(\mu = (\mu_0, \mathcal{S},
\mathcal{P}, \mathcal{R}, \gamma)\)</span>.</p>
<p>We can simplify the transition-based graph in <a href="#fig-graph" class="quarto-xref">Figure&nbsp;2</a> by removing the specification on which action is taken and summing the remaining edges which make the same transition. This shows how inducing the policy removes the need to specify <span class="math inline">\(\mathcal{A}\)</span> in the model definition: now that a specific set of actions is prescribed for each state, even if we don’t know which exact action will be taken, we can describe the transition from state-to-state via a probability that does not depend on the exact action taken, but rather the total probability of moving from one state to another across all actions that lead to the given transition.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-graph-simplified" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graph-simplified-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<svg width="672" height="480" viewbox="0.00 0.00 297.16 221.60" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 217.6)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-217.6 293.16,-217.6 293.16,4 -4,4"></polygon>
<!-- A -->
<g id="node1" class="node">
<title>A</title>
<ellipse fill="none" stroke="black" cx="170" cy="-195.6" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="170" y="-191.4" font-family="Times,serif" font-size="14.00">A</text>
</g>
<!-- A&#45;&gt;A -->
<g id="edge3" class="edge">
<title>A-&gt;A</title>
<path fill="none" stroke="black" d="M195.24,-202.16C219.9,-205.78 247,-203.59 247,-195.6 247,-188.7 226.8,-186.13 205.41,-187.88"></path>
<polygon fill="black" stroke="black" points="204.78,-184.43 195.24,-189.04 205.57,-191.39 204.78,-184.43"></polygon>
<text text-anchor="start" x="247" y="-191.4" font-family="Times,serif" font-size="14.00">0.2, -1</text>
</g>
<!-- H -->
<g id="node2" class="node">
<title>H</title>
<ellipse fill="none" stroke="black" cx="27" cy="-106.8" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-102.6" font-family="Times,serif" font-size="14.00">H</text>
</g>
<!-- A&#45;&gt;H -->
<g id="edge1" class="edge">
<title>A-&gt;H</title>
<path fill="none" stroke="black" d="M143,-195.17C113.16,-194.25 65.73,-187.99 38.5,-159.6 32.18,-153.01 29.02,-143.75 27.54,-134.87"></path>
<polygon fill="black" stroke="black" points="31.01,-134.4 26.47,-124.82 24.05,-135.14 31.01,-134.4"></polygon>
<text text-anchor="start" x="39" y="-147" font-family="Times,serif" font-size="14.00">0.4, 1</text>
</g>
<!-- C -->
<g id="node3" class="node">
<title>C</title>
<ellipse fill="none" stroke="black" cx="176" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="176" y="-13.8" font-family="Times,serif" font-size="14.00">C</text>
</g>
<!-- A&#45;&gt;C -->
<g id="edge2" class="edge">
<title>A-&gt;C</title>
<path fill="none" stroke="black" d="M170.59,-177.44C171.63,-147.02 173.8,-83.38 175.05,-46.68"></path>
<polygon fill="black" stroke="black" points="178.57,-46.34 175.41,-36.23 171.57,-46.1 178.57,-46.34"></polygon>
<text text-anchor="start" x="174" y="-102.6" font-family="Times,serif" font-size="14.00">0.4, 1</text>
</g>
<!-- H&#45;&gt;A -->
<g id="edge5" class="edge">
<title>H-&gt;A</title>
<path fill="none" stroke="black" d="M46.44,-119.6C71.14,-134.59 113.94,-160.57 142.12,-177.68"></path>
<polygon fill="black" stroke="black" points="140.35,-180.7 150.71,-182.89 143.98,-174.71 140.35,-180.7"></polygon>
<text text-anchor="start" x="112" y="-147" font-family="Times,serif" font-size="14.00">0.375, 1</text>
</g>
<!-- H&#45;&gt;H -->
<g id="edge4" class="edge">
<title>H-&gt;H</title>
<path fill="none" stroke="black" d="M52.24,-113.36C76.9,-116.98 104,-114.79 104,-106.8 104,-99.9 83.8,-97.33 62.41,-99.08"></path>
<polygon fill="black" stroke="black" points="61.78,-95.63 52.24,-100.24 62.57,-102.59 61.78,-95.63"></polygon>
<text text-anchor="start" x="104" y="-102.6" font-family="Times,serif" font-size="14.00">0.25, -1</text>
</g>
<!-- H&#45;&gt;C -->
<g id="edge6" class="edge">
<title>H-&gt;C</title>
<path fill="none" stroke="black" d="M24.54,-88.39C23.98,-77.25 25.3,-63.21 33.5,-54 47.4,-38.39 102.01,-28.41 139.45,-23.26"></path>
<polygon fill="black" stroke="black" points="140.05,-26.71 149.5,-21.93 139.13,-19.77 140.05,-26.71"></polygon>
<text text-anchor="start" x="34" y="-58.2" font-family="Times,serif" font-size="14.00">0.375, 1</text>
</g>
<!-- C&#45;&gt;A -->
<g id="edge8" class="edge">
<title>C-&gt;A</title>
<path fill="none" stroke="black" d="M194.13,-31.68C201.21,-37.62 208.65,-45.3 213,-54 227.1,-82.19 220.12,-93.44 217,-124.8 215.44,-140.5 217.91,-145.95 210,-159.6 206.6,-165.47 201.85,-170.85 196.82,-175.55"></path>
<polygon fill="black" stroke="black" points="194.18,-173.19 188.81,-182.32 198.7,-178.53 194.18,-173.19"></polygon>
<text text-anchor="start" x="222" y="-102.6" font-family="Times,serif" font-size="14.00">0.45, 1</text>
</g>
<!-- C&#45;&gt;H -->
<g id="edge9" class="edge">
<title>C-&gt;H</title>
<path fill="none" stroke="black" d="M156.13,-30.57C130.38,-45.58 85.27,-71.85 55.77,-89.04"></path>
<polygon fill="black" stroke="black" points="53.66,-86.22 46.79,-94.27 57.19,-92.26 53.66,-86.22"></polygon>
<text text-anchor="start" x="115" y="-58.2" font-family="Times,serif" font-size="14.00">0.45, 1</text>
</g>
<!-- C&#45;&gt;C -->
<g id="edge7" class="edge">
<title>C-&gt;C</title>
<path fill="none" stroke="black" d="M201.24,-24.56C225.9,-28.18 253,-25.99 253,-18 253,-11.1 232.8,-8.53 211.41,-10.28"></path>
<polygon fill="black" stroke="black" points="210.78,-6.83 201.24,-11.44 211.57,-13.79 210.78,-6.83"></polygon>
<text text-anchor="start" x="253" y="-13.8" font-family="Times,serif" font-size="14.00">0.1, -1</text>
</g>
</g>
</svg>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graph-simplified-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Simplified Model Transition Graph with Actions Removed
</figcaption>
</figure>
</div>
</div>
</div>
<p>Using the same helper sets and function from <a href="#section-16">6.1</a>, we can define each element of the model:</p>
<p><span class="math inline">\(\mathcal{S} = \{ s_A, s_H, s_C \}\)</span> where each state corresponds to the user’s desired genre, which is either Action, Horror, or Comedy, respectively.</p>
<p><span class="math inline">\(\mu_0 = \left[  \frac{1}{3},  \frac{1}{3},  \frac{1}{3} \right]\)</span> where the order of the indices is Action, Horror, Comedy.</p>
<p><span class="math inline">\(\mathcal{P} = \mathcal{P}(s): \mathcal{S} \to \Delta
(\mathcal{S})\)</span> where the function can be described by the transition matrix as:</p>
<p><span class="math display">\[
\mathcal{P}(s) = \begin{bmatrix}
0.2 &amp; 0.4 &amp; 0.4 \\
0.375 &amp; 0.25 &amp; 0.375 \\
0.45 &amp; 0.45 &amp; 0.1 \\
\end{bmatrix}
\]</span></p>
<p>Where the rows and columns follow the same Action, Horror, Comedy order as usual. The values of this matrix are found in the graph in <a href="#fig-graph-simplified" class="quarto-xref">Figure&nbsp;3</a> above, which were calculated as described in <a href="#sec-method" class="quarto-xref">Section&nbsp;11.2.1</a>.</p>
<p><span class="math inline">\(\mathcal{R} = \mathcal{R}(s): \mathcal{S} \to [-1, 1]\)</span></p>
<p>Where the reward function can be defined piecewise as:</p>
<p><span class="math display">\[
\mathcal{R}(s_t) = \begin{cases}
1, \quad s_t \\
0, \quad i \notin \mathcal{G}(j), i \in G, j \in M \\
\end{cases}
\]</span></p>
<p>Which is to say that if the genre preference defined by the input state <span class="math inline">\(s_i\)</span> (where <span class="math inline">\(i\)</span> is the genre in the set of genres <span class="math inline">\(G\)</span>) is in the set of genres of the movie chosen in action <span class="math inline">\(a_j\)</span> (which is the output of the function <span class="math inline">\(\mathcal{G}(j)\)</span> where <span class="math inline">\(j\)</span> is the movie in the set of movies <span class="math inline">\(M\)</span>), then the reward will be 1, which corresponds to the user submitting a Like, and if the desired genre is <em>not</em> in the set of genres for the movie chosen, the reward is -1, corresponding to the user submitting a Dislike.</p>
<p><span class="math inline">\(\gamma = 0.95\)</span></p>
</section>
<section id="section-19" class="level3">
<h3 class="anchored" data-anchor-id="section-19">6.4</h3>
<p>The first five timesteps are represented below:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 235.00 332.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 328)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-328 231,-328 231,4 -4,4"></polygon>
<!-- S0 -->
<g id="node1" class="node">
<title>S0</title>
<ellipse fill="none" stroke="black" cx="99" cy="-306" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-301.8" font-family="Times,serif" font-size="14.00">S0</text>
</g>
<!-- S1 -->
<g id="node2" class="node">
<title>S1</title>
<ellipse fill="none" stroke="black" cx="31" cy="-234" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="31" y="-229.8" font-family="Times,serif" font-size="14.00">S1</text>
</g>
<!-- S0&#45;&gt;S1 -->
<g id="edge1" class="edge">
<title>S0-&gt;S1</title>
<path fill="none" stroke="black" d="M84.91,-290.5C75.43,-280.73 62.76,-267.69 52.08,-256.7"></path>
<polygon fill="black" stroke="black" points="54.55,-254.22 45.07,-249.49 49.53,-259.1 54.55,-254.22"></polygon>
</g>
<!-- S2 -->
<g id="node4" class="node">
<title>S2</title>
<ellipse fill="none" stroke="black" cx="150" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="150" y="-157.8" font-family="Times,serif" font-size="14.00">S2</text>
</g>
<!-- S0&#45;&gt;S2 -->
<g id="edge3" class="edge">
<title>S0-&gt;S2</title>
<path fill="none" stroke="black" d="M100.95,-287.78C103.41,-269.48 108.53,-239.95 118,-216 121.93,-206.06 127.64,-195.84 133.15,-187.07"></path>
<polygon fill="black" stroke="black" points="136.2,-188.8 138.73,-178.51 130.34,-184.97 136.2,-188.8"></polygon>
</g>
<!-- S1&#45;&gt;S2 -->
<g id="edge4" class="edge">
<title>S1-&gt;S2</title>
<path fill="none" stroke="black" d="M50.65,-221.44C69.94,-210.09 99.58,-192.66 121.47,-179.78"></path>
<polygon fill="black" stroke="black" points="123.48,-182.66 130.32,-174.58 119.93,-176.63 123.48,-182.66"></polygon>
</g>
<!-- S3 -->
<g id="node6" class="node">
<title>S3</title>
<ellipse fill="none" stroke="black" cx="86" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="86" y="-85.8" font-family="Times,serif" font-size="14.00">S3</text>
</g>
<!-- S1&#45;&gt;S3 -->
<g id="edge6" class="edge">
<title>S1-&gt;S3</title>
<path fill="none" stroke="black" d="M30.32,-215.86C30.21,-197.37 31.87,-167.44 42,-144 46.99,-132.45 55.31,-121.45 63.38,-112.49"></path>
<polygon fill="black" stroke="black" points="65.97,-114.84 70.31,-105.18 60.89,-110.02 65.97,-114.84"></polygon>
</g>
<!-- A0 -->
<g id="node3" class="node">
<title>A0</title>
<ellipse fill="none" stroke="black" cx="27" cy="-306" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="27" y="-301.8" font-family="Times,serif" font-size="14.00">A0</text>
</g>
<!-- A0&#45;&gt;S1 -->
<g id="edge2" class="edge">
<title>A0-&gt;S1</title>
<path fill="none" stroke="black" d="M27.99,-287.7C28.43,-279.98 28.96,-270.71 29.45,-262.11"></path>
<polygon fill="black" stroke="black" points="32.95,-262.29 30.02,-252.1 25.96,-261.89 32.95,-262.29"></polygon>
</g>
<!-- S2&#45;&gt;S3 -->
<g id="edge7" class="edge">
<title>S2-&gt;S3</title>
<path fill="none" stroke="black" d="M136.43,-146.15C127.69,-136.6 116.17,-123.99 106.34,-113.25"></path>
<polygon fill="black" stroke="black" points="108.88,-110.84 99.55,-105.82 103.72,-115.57 108.88,-110.84"></polygon>
</g>
<!-- S4 -->
<g id="node8" class="node">
<title>S4</title>
<ellipse fill="none" stroke="black" cx="145" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="145" y="-13.8" font-family="Times,serif" font-size="14.00">S4</text>
</g>
<!-- S2&#45;&gt;S4 -->
<g id="edge9" class="edge">
<title>S2-&gt;S4</title>
<path fill="none" stroke="black" d="M149.4,-143.87C148.54,-119.67 146.98,-75.21 145.96,-46.39"></path>
<polygon fill="black" stroke="black" points="149.46,-46.06 145.61,-36.19 142.46,-46.31 149.46,-46.06"></polygon>
</g>
<!-- A1 -->
<g id="node5" class="node">
<title>A1</title>
<ellipse fill="none" stroke="black" cx="154" cy="-234" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="154" y="-229.8" font-family="Times,serif" font-size="14.00">A1</text>
</g>
<!-- A1&#45;&gt;S2 -->
<g id="edge5" class="edge">
<title>A1-&gt;S2</title>
<path fill="none" stroke="black" d="M153.01,-215.7C152.57,-207.98 152.04,-198.71 151.55,-190.11"></path>
<polygon fill="black" stroke="black" points="155.04,-189.89 150.98,-180.1 148.05,-190.29 155.04,-189.89"></polygon>
</g>
<!-- S3&#45;&gt;S4 -->
<g id="edge10" class="edge">
<title>S3-&gt;S4</title>
<path fill="none" stroke="black" d="M98.8,-73.81C106.61,-64.55 116.75,-52.52 125.53,-42.09"></path>
<polygon fill="black" stroke="black" points="128.45,-44.06 132.22,-34.16 123.1,-39.55 128.45,-44.06"></polygon>
</g>
<!-- A2 -->
<g id="node7" class="node">
<title>A2</title>
<ellipse fill="none" stroke="black" cx="78" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="78" y="-157.8" font-family="Times,serif" font-size="14.00">A2</text>
</g>
<!-- A2&#45;&gt;S3 -->
<g id="edge8" class="edge">
<title>A2-&gt;S3</title>
<path fill="none" stroke="black" d="M79.98,-143.7C80.86,-135.98 81.92,-126.71 82.9,-118.11"></path>
<polygon fill="black" stroke="black" points="86.39,-118.44 84.05,-108.1 79.43,-117.64 86.39,-118.44"></polygon>
</g>
<!-- A3 -->
<g id="node9" class="node">
<title>A3</title>
<ellipse fill="none" stroke="black" cx="200" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="200" y="-85.8" font-family="Times,serif" font-size="14.00">A3</text>
</g>
<!-- A3&#45;&gt;S4 -->
<g id="edge11" class="edge">
<title>A3-&gt;S4</title>
<path fill="none" stroke="black" d="M188.07,-73.81C180.79,-64.55 171.34,-52.52 163.15,-42.09"></path>
<polygon fill="black" stroke="black" points="165.84,-39.86 156.91,-34.16 160.34,-44.18 165.84,-39.86"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>